# 一 概述:
## (1)同步I/O:
- **阻塞式IO**: read阻塞进程直至数据被拷贝进用户地址空间；write在数据被拷贝到page cache后结束.
- **非阻塞式I/O**: O_NONBLOCK非阻塞模式打开(open)文件或修改文件fd(fcntl), read时候不阻塞进程, 没数据可读则返回EAGIN错误. 注意: 普通文件不会阻塞, 没数据直接返回-1(EOF), 这里主要针对套接字, 管道, 块设备文件和字符设备文件等类型.
- **I/O复用(io multiplex)(select/poll/epoll)**: 也称异步阻塞.
- **信号驱动I/O**:内核在描述符就绪时发生SIGIO信号通知程序.

## (2)异步I/O:
- 告知内核执行某个操作, 待内核在操作完成后通知程序.
- 与信号驱动I/O区别:信号驱动I/O由内核通知我们何时启动一个I/O操作, 异步I/O由内核通知我们何时I/O操作完成.
- 相关库:libaio(内核支持)和posix aio(用户层, 用多线程模拟异步IO).

# 二 IO编程:
## (1)类型:
- 系统IO:面向文件描述符的不带缓冲(unbuffered)的IO, 每次read和write调用都直接调用底层系统调用.
- 标准IO:面向流的带缓冲的IO, 目的是尽可能减少read和write调用的次数.

## (2)系统IO
- 默认情况下, 读写文件都经过页高速缓存(page cache), 可通过open函数的相关flag控制.
- STDIN_FILENO、STDOUT_FILENO和STDERR_FILENO.
- 相关函数:open, read, write, fsync等.
- 底层使用内核的磁盘高速缓存, 该缓存是内核拥有, 对内核态的所有进程都可见.

## (3)标准IO:
- stdin、stdout和stderr表示三个标准工作流.
- 相关函数:printf等.

# 三 系统IO:
## (1)访问文件的模式:
- **规范模式**:open文件, O_SYNC和O_DIRECT都为0, 内容由read和write来存取, read阻塞进程直至数据被拷贝进用户地址空间；write在数据被拷贝到page cache后结束.
- **同步模式**:open文件O_SYNC为1或打开后使用fcntl设置为1, 只影响write, write操作将阻塞进程, 直至数据被有效写入磁盘.
- **内存映射模式**:打开文件后, 调用mmap将文件映射到内存, 文件称为ram中的一个数组, 可以直接访问, 无需通过read和write访问.
- **直接IO模式**:O_DIRECT置为1, 读写操作都将数据在用户态地址空间和磁盘间直接传送而不通过页高速缓存, 通常会降低性能, 但是在特定情况下有用, 例如程序有自己的缓存(cache).
- **异步IO模式**.

# 四 标准IO:
## (1)目的:
- 提供缓冲的目的尽可能减少read和write的调用次数.
- 缓冲可由标准IO自动刷新(例如填满时)或调用fflush手动触发刷新.

## (2)三种类型缓冲:
- 全缓冲:该情况下, 只有在填满标准I/O缓冲区后才进行实际的I/O操作。对于磁盘上的文件, 进行标准IO操作时一般都是全缓冲, 在第一次进行IO操作时, 通常调用malloc来获得需使用的缓冲区.
- 行缓冲:当输入和输出中遇到换行符时, 标准库IO会执行刷新, 当涉及到中断时(例如stdin和stdout)时, 通常使用行缓冲.
- 不带缓冲:标准出错.
- 相关函数: setbuf和setvbuf改变系统默认的缓冲类型; fflush强制刷新缓冲.

## (3)打开标准I/O流:
- fopen: 打开路径名为pathname的一个指定文件.
- fdopen: 取一个已存在的文件描述符的(open, socket等创建的)的标准I/O流.
- freopen:函数在一个指定的流上打开一个指定的文件.

## (4)读/写流:
- 每次一个字符的读取.
- 每次一行的读取.
- 直接IO: 每次读写指定数量的对象, 而每个对象具有指定的长度, 常用于二进制文件读写: fread和fwrite.
