# 一 概述:
## (1)概述:
- 驱动程序通知内核新帧的方式: 旧函数(netif_rx)和NAPI.

## (2)中断处理程序:
- 把帧拷贝到sk_buff数据结构. 
- 对一些sk_buff做初始化.
- 更新一些设置私有的参数.

# 二 NAPI:
## (1)逻辑:
- 混合使用轮询和中断.
- 若接收到新帧, 内核还有未完成处理的帧, 则驱动程序不会产生新的中断事件, 让内核一直处理输入队列中的数据(设备关闭中断).
- 当输入队列为空时再重启开启中断.

## (2)特点:
- 异步事件: 帧的接收还是由中断事件触发.
- 若内核知道设备的入口队列有数据存在, 则没必要浪费时间去处理中断事件, 使用简单的轮询就好.
- 备注: 轮询函数(poll)由驱动程序提供, 在驱动程序初始化时候调用netif_napi_add来初始化.

## (3)优点:
- 减少了CPU的负载(中断事件变少)
- 设备的处理更为公平(若设备的入口队列有数据, 则会以相对公平的循环方式处理).

## (4)备注:
- NAPI设备有自己的私有队列.

# 三 net_rx_action:
## (1)概述:
- NAPI和非NAPI都是由该函数接收包.
- 非NAPI的poll函数在net_dev_init时初始化为process_backlog.
- NAPI的poll函数由设备驱动程序提供并在初始化时调用netif_napi_add来设置.
- poll函数会调用netif_receive_skb来处理包.

# 二 netif_receive_skb:
## (1)概述:
- 主要的包接收处理方法, 通常是成功, buffer在处理过程中可能被congestion control或者协议层丢弃.
- 在softireq上下文中执行.

## (2)功能:
- 把帧的副本传给每个协议分流器, 例如:包嗅觉器(sniffer).
- 把帧的副本传给skb->protocol锁关联的L3协议处理函数.
- 负责此层必须处理的一些功能, 例如桥接(老版本是handle_bridge, 新版本是br_handle_frame, 在接口加入模式时设置在net_device的rx_handler字段).
