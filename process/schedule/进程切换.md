# 一 概述:
## (1)概述:
- 实现: kernel/sched/core.c.
## (2)调度时机
## (3)进程和线程上下文切换区别.

# 二 __schedule
## (1)实现:

## (2)主要调用场景:
- **显式锁**: mutex, semaphorem, waitqueue等.
- **设置了TIF_NEED_RESCHED标志**: 该flag在中断或用户空间返回路径上会被check, 为了drive任务间的preemption, 会在中断处理函数schedule_tick内被设置.
- wakeup: 唤醒不会导致进入schedule, 它只是将任务添加到运行队列. 若新的任务添加到运行队列, 抢占当前任务, 则wake会设置TIF_NEED_RESCHED并在合适时机调用schedule.

## (3)调用方:
- io_schedule->schedule->__schedule.
- do_sched_yeild: 让出当前cpu给其它线程, 若没有其它线程允许在当前cpu, 则返回.

# 三 context_switch:
## (1)功能
- switch to the new MM and the new thread's register state.

## (2)switch_mm:
- switch内存.

## (3)switch_to:
- switch寄存器状态和栈.
